<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
      lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lista de Clientes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link th:href="@{/css/estilos.css}" rel="stylesheet">
  <link th:href="@{/css/layout.css}" rel="stylesheet">
</head>
<body>
  <div th:replace="~{fragments/headher :: headher}"></div>
  <div th:replace="~{fragments/navibar :: navibar}"></div>

  <div class="container my-5">
    <div class="card soft bg-white">
      <div class="card-header d-flex justify-content-between align-items-center" style="background:#8B0000;color:#fff;">
        <h3 class="mb-0">Lista de Clientes</h3>
        <div class="d-flex gap-2">
          <a th:href="@{/}" class="btn btn-light btn-sm">Inicio</a>
          <a th:href="@{/clientes/crear}" class="btn btn-success btn-sm" sec:authorize="hasAnyRole('ADMIN', 'CAJERO')">+ Nuevo Cliente</a>
        </div>
      </div>

      <div class="card-body">
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Foto</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Email</th>
                <th class="text-end">Crédito</th>
                <th>Teléfono</th>
                <th>Destacado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="c : ${clientes}">
                <td th:text="${c.id}">1</td>
                <td>
                  <img th:if="${c.fotoCliente != null and !c.fotoCliente.isEmpty()}"
                       th:src="${c.fotoCliente}"
                       alt="Foto" width="50" height="50"
                       class="rounded-circle border"
                       style="object-fit: cover;">

                  <img th:unless="${c.fotoCliente != null and !c.fotoCliente.isEmpty()}"
                       th:src="@{/imagen/user_placeholder.png}"
                       alt="Sin Foto" width="50" height="50"
                       class="rounded-circle border bg-light p-1"
                       style="object-fit: contain; opacity: 0.5;">
                  </td>
                <td th:text="${c.nombre ?: ''}">Nombre</td>
                <td th:text="${c.apellido ?: ''}">Apellido</td>
                <td><a th:href="'mailto:' + ${c.email}" th:text="${c.email}">correo@ejemplo.com</a></td>
                <td class="text-end" th:text="${#numbers.formatDecimal(c.credito,1,'POINT',2,'POINT')}">0.00</td>
                <td><a th:href="'tel:' + ${c.telefono}" th:text="${c.telefono}">0000000000</a></td>
                <td>
                  <span th:if="${c.destacado} == 1" class="badge bg-success">Sí</span>
                  <span th:if="${c.destacado} != 1" class="badge bg-secondary">No</span>
                </td>
                <td class="d-flex gap-1" sec:authorize="hasAnyRole('ADMIN', 'CAJERO')">
                  <a th:href="@{/clientes/ver/{id}(id=${c.id})}" class="btn btn-sm btn-primary">Detalles</a>
                  <a th:href="@{/clientes/editar/{id}(id=${c.id})}" class="btn btn-sm btn-warning">Editar</a>
                  <a th:href="@{/clientes/eliminar/{id}(id=${c.id})}"
                     class="btn btn-sm btn-danger"
                     onclick="return confirm('¿Eliminar este cliente?');">Eliminar</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div th:replace="~{fragments/fhooter :: fhooter}"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


