<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="es">
<head>
  <meta charset="UTF-8">
  <title>MenÃº a la Parrilla</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link th:href="@{/css/estilos.css}" rel="stylesheet">
  <link th:href="@{/css/layout.css}" rel="stylesheet">
</head>
<body>
  <div th:replace="~{fragments/headher :: headher}"></div>
  <div th:replace="~{fragments/navibar :: navibar}"></div>

  <div class="container my-5">

    <div class="card soft mb-3 shadow-sm">
      <div class="card-header parrilla d-flex justify-content-between align-items-center">
        <h3 class="mb-0">MenÃº a la Parrilla</h3>
        <div class="d-flex gap-2">
          <a th:href="@{/clientes}" class="btn btn-outline-secondary btn-sm">Ver Clientes</a>
          <a th:href="@{/}" class="btn btn-outline-secondary btn-sm">Inicio</a>
        </div>
      </div>
    </div>

    <form class="card soft p-3 mb-4 shadow-sm" th:action="@{/menu}" method="get">
      <input type="hidden" name="clienteId" th:if="${clienteActivoId != null}" th:value="${clienteActivoId}"> 
      
      <div class="row g-2 align-items-end">
        <div class="col-12 col-md-3">
          <label class="form-label fw-semibold">Tipo</label>
          <select class="form-select" name="tipo">
            <option value="" th:selected="${tipoActivo==null}">â€” Todos â€”</option>
            <option th:each="t : ${T(isa.restaurante.modelo.TipoProducto).values()}"
                    th:value="${t}"
                    th:text="${t}"
                    th:selected="${tipoActivo != null and tipoActivo == t}">
            </option>
          </select>
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label fw-semibold">Precio mÃ­n</label>
          <input type="number" step="0.01" class="form-control" name="min" th:value="${min}">
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label fw-semibold">Precio mÃ¡x</label>
          <input type="number" step="0.01" class="form-control" name="max" th:value="${max}">
        </div>

        <div class="col-12 col-md-2">
          <label class="form-label fw-semibold">Nombre contiene</label>
          <input class="form-control" name="q" th:value="${q}" placeholder="ej. limonada">
        </div>

        <div class="col-6 col-md-1 d-flex align-items-center gap-2">
          <input class="form-check-input" type="checkbox" id="ordenAsc" name="ordenarAsc" value="true"
                 th:checked="${ordenarAsc}">
          <label class="form-check-label" for="ordenAsc">Precio â†‘</label>
        </div>

        <div class="col-6 col-md-1 d-grid">
          <button class="btn btn-primary">Filtrar</button>
        </div>
        <div class="col-6 col-md-1 d-grid">
          <a th:href="@{/menu}" class="btn btn-light">Limpiar</a>
        </div>
        </div>
    </form>

    <form th:action="@{/pedidos/crear-desde-menu}" method="post" class="mb-4">
      <div class="card soft p-3 shadow-sm mb-4">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md-6 col-lg-4">
            <label class="form-label fw-semibold">Cliente</label>
            <select name="clienteId" class="form-select" required>
              <option value="" disabled 
                      th:selected="${clienteActivoId==null}">â€” Selecciona cliente â€”</option>
              <option th:each="c : ${clientes}"
                      th:value="${c.id}"
                      th:text="${(c.nombre ?: '') + ' ' + (c.apellido ?: '') + ' â€” ID:' + c.id}"
                      
                      th:selected="${clienteActivoId != null and clienteActivoId == c.id}">
              </option>
            </select>
          </div>
          <div class="col-12 col-md-6 col-lg-8 text-md-end">
            <button type="submit" class="btn btn-success">
              ðŸ›’ Crear pedido con productos seleccionados
            </button>
          </div>
        </div>
      </div>

      <div class="row g-4">
        <div class="col-12 col-sm-6 col-lg-4" th:each="p : ${productos}">
          <div class="card soft h-100 shadow-sm">
            
            <div style="height: 200px; overflow: hidden; background-color: #f8f9fa;">
                <img th:if="${p.fotoProducto != null and !p.fotoProducto.isEmpty()}"
                     th:src="${p.fotoProducto}"
                     class="card-img-top h-100 w-100"
                     style="object-fit: cover;"
                     alt="Foto producto">

                <img th:unless="${p.fotoProducto != null and !p.fotoProducto.isEmpty()}"
                     th:src="@{/imagen/sin_foto.png}"
                     class="card-img-top h-100 w-100"
                     style="object-fit: cover; opacity: 0.6;"
                     alt="Sin imagen">
            </div>
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-1" th:text="${p.nombre}">Producto</h5>
                <span class="badge bg-warning text-dark"
                      th:text="${#strings.capitalize(p.tipo.name().toLowerCase())}">Tipo</span>
              </div>

              <p class="text-muted small mb-3" th:text="${p.descripcion}">DescripciÃ³nâ€¦</p>

              <div class="mt-auto d-flex justify-content-between align-items-center">
                <span class="fw-bold text-success"
                      th:text="${'$ ' + #numbers.formatDecimal(p.precio, 1, 'POINT', 2, 'POINT')}">$0.00</span>

                <div class="d-flex align-items-center gap-2">
                  <label class="text-muted small mb-0">Cant.</label>
                  <input type="hidden" name="productoId" th:value="${p.id}">
                  <input type="number" name="cantidad" min="0" value="0"
                         class="form-control form-control-sm" style="width:80px;">
                </div>
              </div>
            </div>

            <div class="card-footer bg-light border-top d-flex gap-2 justify-content-center">
              <a th:href="@{/menu/ver/{id}(id=${p.id})}" class="btn btn-primary btn-sm">Ver</a>
              <a th:href="@{/pedidos/seleccionar(productoId=${p.id})}"
                 class="btn btn-outline-secondary btn-sm">Agregar a pedidoâ€¦</a>
            </div>
          </div>
        </div>

        <div th:if="${#lists.isEmpty(productos)}" class="text-center text-muted mt-4">
          <p>No hay productos para los filtros aplicados.</p>
        </div>
      </div>
    </form>
  </div>

  <div th:replace="~{fragments/fhooter :: fhooter}"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
