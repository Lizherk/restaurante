<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin | Productos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link th:href="@{/css/estilos.css}" rel="stylesheet">
  <link th:href="@{/css/layout.css}" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/headher :: headher}"></div>
<div th:replace="~{fragments/navibar :: navibar}"></div>

<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Administración de Productos</h3>
    <a th:href="@{/admin/productos/crear}" class="btn btn-success btn-sm">+ Nuevo Producto</a>
  </div>

  <form class="card soft p-3 mb-3 shadow-sm" th:action="@{/admin/productos}" method="get"> 
    <div class="row g-2 align-items-end">
      <div class="col-12 col-md-4">
        <label class="form-label">Nombre contiene</label>
        <input class="form-control" name="nombre" th:value="${nombre}" placeholder="ej. limonada, arrachera…">
      </div>
      <div class="col-12 col-md-3">
        <label class="form-label">Tipo</label>
        <select class="form-select" name="tipo">
          <option value="" th:selected="${tipo==null}">— Todos —</option>
          <option th:each="t : ${tipos}"
                  th:value="${t}" th:text="${t}"
                  th:selected="${tipo!=null and tipo==t}">PLATILLO</option>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Precio mín</label>
        <input type="number" step="0.01" class="form-control" name="min" th:value="${min}">
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">Precio máx</label>
        <input type="number" step="0.01" class="form-control" name="max" th:value="${max}">
      </div>
      <div class="col-6 col-md-1 d-grid">
        <button class="btn btn-primary">Filtrar</button>
      </div>
      <div class="col-6 col-md-1 d-grid">
        <a th:href="@{/admin/productos}" class="btn btn-light">Limpiar</a> 
      </div>
    </div>
  </form>

  <div class="card soft">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead>
        <tr>
          <th>#</th>
          <th>Foto</th>
          <th>Nombre</th>
          <th>Tipo</th>
          <th class="text-end">Precio</th>
          <th class="text-wrap">Descripción</th>
          <th class="text-end">Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="p : ${productos}">
          <td th:text="${p.id}">1</td>
          <td>
            <img th:if="${p.fotoProducto != null and !p.fotoProducto.isEmpty()}"
                 th:src="${p.fotoProducto}"
                 alt="Foto" width="60" height="60"
                 class="rounded border" style="object-fit: cover;">
                 
            <img th:unless="${p.fotoProducto != null and !p.fotoProducto.isEmpty()}"
                 th:src="@{/imagen/sin_foto.png}"
                 alt="Sin Foto" width="60" height="60"
                 class="rounded border bg-light p-1" style="object-fit: contain; opacity: 0.5;">
            </td>
          <td th:text="${p.nombre}">Nombre</td>
          <td>
            <span class="badge bg-warning text-dark"
                  th:text="${#strings.capitalize(p.tipo.name().toLowerCase())}">Platillo</span>
          </td>
          <td class="text-end"
              th:text="${'$ ' + #numbers.formatDecimal(p.precio,1,'POINT',2,'POINT')}">$0.00</td>
          <td class="small text-wrap" th:text="${p.descripcion}">Descripción…</td>
          <td class="text-end">
            <div class="btn-group">
              <a th:href="@{/menu/ver/{id}(id=${p.id})}" class="btn btn-sm btn-outline-primary">Ver</a>
              <a th:href="@{/admin/productos/editar/{id}(id=${p.id})}" class="btn btn-sm btn-warning">Editar</a>
              <a th:href="@{/admin/productos/eliminar/{id}(id=${p.id})}"
                 class="btn btn-sm btn-danger"
                 onclick="return confirm('¿Eliminar producto?');">Eliminar</a>
            </div>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(productos)}">
          <td colspan="7" class="text-center text-muted py-4">No hay productos para los filtros aplicados.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div th:replace="~{fragments/fhooter :: fhooter}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
